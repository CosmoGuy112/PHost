# Kernel
</div>

## หน้าที่ของ Kernel 
Kernal คือศูนย์กลางในระบบ Computer โดยจะทำหน้าที่ควบคุมการทำงานตั้งแต่ Booting server, Start/Stop Program และจัดการกับ Input/Output จาก Software โดย Kernal จะคล้ายกับสะพานเชื่อมระหว่างส่วนของ Application กับ Data Processing ใน Hardware level ซึ่ง Kernal จะอยู่ตรงกลางที่เชื่อม ให้ programและApplicationอื่น ๆ ในระบบ เป็นโปรแกรมพื้นฐานภายใต้ระบบปฏิบัติการคอมพิวเตอร์ (OS) ที่คอยทำหน้าที่เป็นสื่อกลางระหว่างฮาร์ดแวร์ กับ ซอฟต์แวร์และช่วยจัดการทรัพยากรในคอมพิวเตอร์ต่าง ๆ เพื่อให้สามารถเข้าถึงและใช้งานทรัพยากรของระบบได้อย่างมีประสิทธิภาพ และปลอดภัย เช่น การใช้พื้นที่ หน่วยความจำ (RAM) , การใช้ หน่วยประมวลผลกลาง (CPU) การจัดการไฟล์ และ ระบบอื่น ๆ

1. ให้ส่วนติดต่อที่จำเป็นสำหรับผู้ใช้และแอปพลิเคชันสื่อสารกับคอมพิวเตอร์ Kernel ให้ส่วนติดต่อและแอบสมมติที่จำเป็นให้กับผู้ใช้และแอปพลิเคชันเพื่อให้สามารถสื่อสารกับระบบคอมพิวเตอร์ได้ ซึ่งรวมถึงการจัดการกับการอินพุทและเอาท์พุท, ระบบไฟล์, การสื่อสารผ่านเครือข่าย และทรัพยากรอื่น ๆ

2. เริ่มต้นและจัดการแอปพลิเคชัน Kernel รับผิดชอบในการเริ่มต้น, จัดการ, และควบคุมการทำงานของแอปพลิเคชันและโปรเซสที่ทำงานบนระบบ ซึ่งรวมถึงการจัดสรรทรัพยากรระบบ เช่น หน่วยความจำ, เวลา CPU, และการอินพุท/เอาท์พุท

3. จัดการอุปกรณ์ฮาร์ดแวร์ในระบบ Kernel รับผิดชอบในการจัดการอุปกรณ์ฮาร์ดแวร์ที่อยู่ในระบบ โดยให้บริการการสื่อสารและการทำงานร่วมกับอุปกรณ์ฮาร์ดแวร์ต่าง ๆ เพื่อให้ระบบปฏิบัติการสามารถเข้าถึงและใช้งานอุปกรณ์เหล่านั้นได้อย่างมีประสิทธิภาพ

## ประเภทของ Kernel
-  ### Monolithic Kernels (Kernel ระบบเดียว) ###
    เป็น Kernel ที่มีโครงสร้างที่ใหญ่ ซับซ้อน และ ยากต่อการดูแล ภายหลังจึงได้มีการแยก module ออกมาและทำการเลือก load ใช้งานตามความเหมาะสม เป็นเสมือน extension ให้ OS เลือกใช้ ทำให้ไม่ต้องทำการปิดและ compile ใหม่ทั้งหมด เมื่อมีการแก้ bug ประกอบไปด้วยส่วนหลัก ๆ ทั้งหมดของระบบปฏิบัติการ ซึ่งรวมถึงการจัดการหน่วยความจำ, การจัดการกับอุปกรณ์ฮาร์ดแวร์, การจัดการกับโปรเซส, การจัดการกับไฟล์ระบบ, และการเชื่อมต่อเครือข่าย <br> ตัวอย่างของระบบปฏิบัติการที่ใช้ Monolithic Kernel ได้แก่ Linux (ก่อนหน้านี้), UNIX, BSD, MS-DOS, Microsoft Windows 9x Series, Agnix
   ข้อดี:
   - <div text-decoration-style: solid> ประสิทธิภาพ: </div> เคอร์เนลแบบ Monolithic มักจะมีความเร็วมากกว่าเคอร์เนลประเภทอื่น ๆ เพราะว่าไม่จำเป็นต้องสลับไปมาระหว่างโหมดผู้ใช้และโหมดเคอร์เนลสำหรับทุก system call ซึ่งอาจทำให้เกิด overhead
   - การผสานรวมที่แน่นหนา: เนื่องจากบริการระบบปฏิบัติการทั้งหมดทำงานในพื้นที่เคอร์เนล บริการเหล่านี้จึงสามารถสื่อสารกันได้อย่างมีประสิทธิภาพมากขึ้น ช่วยให้ง่ายต่อการ implement ฟังก์ชันการทำงานและ optimizations ที่ซับซ้อน
   - ความเรียบง่าย: เคอร์เนลแบบ Monolithic นั้นง่ายต่อการออกแบบ implement และ debug มากกว่าเคอร์เนลประเภทอื่น ๆ เพราะว่ามีโครงสร้างที่เป็นหนึ่งเดียว ช่วยให้ง่ายต่อการจัดการโค้ด
   - ความหน่วงเวลาน้อย: เคอร์เนลแบบ Monolithic มีความหน่วงเวลาน้อยกว่าเคอร์เนลประเภทอื่น ๆ เพราะว่า system calls และ interrupts สามารถจัดการโดยเคอร์เนลได้โดยตรง
   

-  ### Microkernel (Kernel ไมโคร) ### 
   เป็น Kernel ที่ทำให้มีการแยกส่วนของระบบพื้นฐาน driver, protocol stack, file system ออกมาrunข้างนอก ทำให้ลดขนาดของ Kernel ลงและยังเพิ่ม security และ stability ให้กับ OS ทำให้มีโครงสร้างที่เล็กและมีความเรียบง่าย โดยมีเพียงส่วนของระบบที่จำเป็นสำหรับการทำงานพื้นฐาน <br> ตัวอย่างของระบบปฏิบัติการที่ใช้ Microkernel ได้แก่ QNX, MINIX, AIX, Android OS, EROS, Mach Kernel 

-  ### Hybrid kernels (เคอร์เนลแบบผสม) ###
    เป็นการผสมผสานระหว่าง Monolithic Kernel และ Microkernel โดยมีลักษณะทั้งสองคุณสมบัติ ถูกนำมาใช้งานกับ OS ระดับ commercial มีลักษณะคล้าย microkernel แต่ว่ามันได้รวมเอา code เสริมใน kernel space มาเพิ่มความสามารถโดยใช้เป็น extension ให้กับ microkernel  <br> ตัวอย่างของระบบปฏิบัติการที่ใช้ Hybrid Kernel ได้แก่ Microsoft Windows และ macOS ตั้งแต่รุ่น XNU ของ macOS และ Darwin Kernel ที่ใช้งานบน macOS และ iOS

## หลักการทำงานของ Kernel<br>
การปฏิบัติตามคำสั่งของระบบปฏิบัติการและให้บริการแก่โปรแกรมและผู้ใช้ทั่วไปในการใช้งานเครื่องคอมพิวเตอร์ หลักการทำงานของ Kernel มีหลายองค์ประกอบที่สำคัญ <br>
1. การจัดการทรัพยากร
2. การสร้างและจัดการโปรเซส
3. การจัดการกับเหตุการณ์และการโต้ตอบ
4. การจัดการกับไดรเวอร์
5. การจัดการความปลอดภัย
6. การจัดการกับความสัมพันธ์ระหว่างโปรแกรม


ข้อควรระวังในการใช้งาน<br>
การเข้าถึงและแก้ไขโค้ดหรือการตั้งค่าใน kernel ต้องมีการให้ความระมัดระวัง เพราะการกระทำไม่ถูกต้องอาจทำให้ระบบล่มหรือทำให้ระบบไม่สามารถทำงานได้<br>

# คำสั่งที่ควรรู้
คำสั่งที่ควรรู้ใน kernel :
```
$ lsmod
```
>เป็นคำสั่งที่จะแสดงสถานะของ kernel ทั้งหมดโดยจะแสดงเป็น list modules 

ผลลัพธ์

![res](https://github.com/CosmoGuy112/PHost/assets/112687431/fe806664-bedd-47b6-8573-53e9bdeefc54)


```
$ insmod 
```
>เป็นคำสั่งที่ insert module เข้าไปที่ kernel โดยตรง โดยคำสั่งนี้ก็เป็นคำสั่งที่ช่วยเพิ่มฟังก์ชั่นของ core ในระบบปฎิบัติการ

```
$ rmmod <Module>
```
>เป็นคำสั่งที่จะ remove module ใน kernel ออก

# References
- https://tips.thaiware.com/1806.html#what-is-a-kernel-task
- https://www.techtarget.com/searchdatacenter/definition/kernel
- https://saixiii.com/what-is-kernel/
- https://th.wikipedia.org/wiki/%E0%B9%83%E0%B8%88%E0%B8%81%E0%B8%A5%E0%B8%B2%E0%B8%87
- https://digilent.com/blog/demystifiying-the-linux-kernel/
- https://www.javatpoint.com/what-is-kernel
- -https://www.computerhope.com/unix/insmod.htm
- https://eng.libretexts.org/Bookshelves/Computer_Science/Operating_Systems/Linux_-_The_Penguin_Marches_On_(McClanahan)/06%3A_Kernel_Module_Management/2.05%3A_Kernel_Module_Management_-_lsmod_Command
